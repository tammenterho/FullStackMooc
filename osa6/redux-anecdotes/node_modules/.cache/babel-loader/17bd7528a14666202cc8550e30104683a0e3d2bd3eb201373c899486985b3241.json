{"ast":null,"code":"\"use strict\";\n\nconst express = require('express');\nconst methodOverride = require('method-override');\nconst _ = require('lodash');\nconst lodashId = require('lodash-id');\nconst low = require('lowdb');\nconst Memory = require('lowdb/adapters/Memory');\nconst FileSync = require('lowdb/adapters/FileSync');\nconst bodyParser = require('../body-parser');\nconst validateData = require('./validate-data');\nconst plural = require('./plural');\nconst nested = require('./nested');\nconst singular = require('./singular');\nconst mixins = require('../mixins');\nmodule.exports = (db, opts) => {\n  opts = Object.assign({\n    foreignKeySuffix: 'Id',\n    _isFake: false\n  }, opts);\n  if (typeof db === 'string') {\n    db = low(new FileSync(db));\n  } else if (!_.has(db, '__chain__') || !_.has(db, '__wrapped__')) {\n    db = low(new Memory()).setState(db);\n  } // Create router\n\n  const router = express.Router(); // Add middlewares\n\n  router.use(methodOverride());\n  router.use(bodyParser);\n  validateData(db.getState()); // Add lodash-id methods to db\n\n  db._.mixin(lodashId); // Add specific mixins\n\n  db._.mixin(mixins); // Expose database\n\n  router.db = db; // Expose render\n\n  router.render = (req, res) => {\n    res.jsonp(res.locals.data);\n  }; // GET /db\n\n  router.get('/db', (req, res) => {\n    res.jsonp(db.getState());\n  }); // Handle /:parent/:parentId/:resource\n\n  router.use(nested(opts)); // Create routes\n\n  db.forEach((value, key) => {\n    if (key === '$schema') {\n      // ignore $schema\n      return;\n    }\n    if (_.isPlainObject(value)) {\n      router.use(`/${key}`, singular(db, key, opts));\n      return;\n    }\n    if (_.isArray(value)) {\n      router.use(`/${key}`, plural(db, key, opts));\n      return;\n    }\n    const sourceMessage = ''; // if (!_.isObject(source)) {\n    //   sourceMessage = `in ${source}`\n    // }\n\n    const msg = `Type of \"${key}\" (${typeof value}) ${sourceMessage} is not supported. ` + `Use objects or arrays of objects.`;\n    throw new Error(msg);\n  }).value();\n  router.use((req, res) => {\n    if (!res.locals.data) {\n      res.status(404);\n      res.locals.data = {};\n    }\n    router.render(req, res);\n  });\n  router.use((err, req, res, next) => {\n    console.error(err.stack);\n    res.status(500).send(err.stack);\n  });\n  return router;\n};","map":{"version":3,"names":["express","require","methodOverride","_","lodashId","low","Memory","FileSync","bodyParser","validateData","plural","nested","singular","mixins","module","exports","db","opts","Object","assign","foreignKeySuffix","_isFake","has","setState","router","Router","use","getState","mixin","render","req","res","jsonp","locals","data","get","forEach","value","key","isPlainObject","isArray","sourceMessage","msg","Error","status","err","next","console","error","stack","send"],"sources":["C:/FullStackMooc/osa6/redux-anecdotes/node_modules/json-server/lib/server/router/index.js"],"sourcesContent":["\"use strict\";\n\nconst express = require('express');\n\nconst methodOverride = require('method-override');\n\nconst _ = require('lodash');\n\nconst lodashId = require('lodash-id');\n\nconst low = require('lowdb');\n\nconst Memory = require('lowdb/adapters/Memory');\n\nconst FileSync = require('lowdb/adapters/FileSync');\n\nconst bodyParser = require('../body-parser');\n\nconst validateData = require('./validate-data');\n\nconst plural = require('./plural');\n\nconst nested = require('./nested');\n\nconst singular = require('./singular');\n\nconst mixins = require('../mixins');\n\nmodule.exports = (db, opts) => {\n  opts = Object.assign({\n    foreignKeySuffix: 'Id',\n    _isFake: false\n  }, opts);\n\n  if (typeof db === 'string') {\n    db = low(new FileSync(db));\n  } else if (!_.has(db, '__chain__') || !_.has(db, '__wrapped__')) {\n    db = low(new Memory()).setState(db);\n  } // Create router\n\n\n  const router = express.Router(); // Add middlewares\n\n  router.use(methodOverride());\n  router.use(bodyParser);\n  validateData(db.getState()); // Add lodash-id methods to db\n\n  db._.mixin(lodashId); // Add specific mixins\n\n\n  db._.mixin(mixins); // Expose database\n\n\n  router.db = db; // Expose render\n\n  router.render = (req, res) => {\n    res.jsonp(res.locals.data);\n  }; // GET /db\n\n\n  router.get('/db', (req, res) => {\n    res.jsonp(db.getState());\n  }); // Handle /:parent/:parentId/:resource\n\n  router.use(nested(opts)); // Create routes\n\n  db.forEach((value, key) => {\n    if (key === '$schema') {\n      // ignore $schema\n      return;\n    }\n\n    if (_.isPlainObject(value)) {\n      router.use(`/${key}`, singular(db, key, opts));\n      return;\n    }\n\n    if (_.isArray(value)) {\n      router.use(`/${key}`, plural(db, key, opts));\n      return;\n    }\n\n    const sourceMessage = ''; // if (!_.isObject(source)) {\n    //   sourceMessage = `in ${source}`\n    // }\n\n    const msg = `Type of \"${key}\" (${typeof value}) ${sourceMessage} is not supported. ` + `Use objects or arrays of objects.`;\n    throw new Error(msg);\n  }).value();\n  router.use((req, res) => {\n    if (!res.locals.data) {\n      res.status(404);\n      res.locals.data = {};\n    }\n\n    router.render(req, res);\n  });\n  router.use((err, req, res, next) => {\n    console.error(err.stack);\n    res.status(500).send(err.stack);\n  });\n  return router;\n};"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}